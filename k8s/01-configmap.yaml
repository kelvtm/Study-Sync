# ============================================
# ConfigMap: Application Configuration
# ============================================
#
# CONCEPT: Store non-sensitive configuration data as key-value pairs
#
# WHY USE CONFIGMAPS?
# 1. Decouple config from container image
# 2. Change config without rebuilding image
# 3. Share config across multiple Pods
# 4. Version control your configuration
#
# WHEN TO USE:
# - Environment variables (NODE_ENV, PORT, etc.)
# - Configuration files
# - Command-line arguments
#
# WHEN NOT TO USE:
# - Sensitive data (use Secrets instead)
# - Large files (use Volumes instead)
# ============================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: studysync-backend-config
  namespace: studysync-dev
  labels:
    app: studysync
    component: backend
data:
  # Simple key-value pairs
  NODE_ENV: "development"
  PORT: "3000"
  LOG_LEVEL: "debug"

  # Feature flags
  ENABLE_REDIS: "false"
  ENABLE_METRICS: "true"

  # CORS configuration
  ALLOWED_ORIGINS: "http://localhost:8080,http://studysync-frontend:80"

  # API configuration
  API_TIMEOUT: "30000"
  MAX_REQUEST_SIZE: "10mb"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: studysync-frontend-config
  namespace: studysync-dev
  labels:
    app: studysync
    component: frontend
data:
  # Frontend environment variables
  VITE_API_URL: "http://studysync-backend:3000"
  VITE_SOCKET_URL: "http://studysync-backend:3000"
  VITE_APP_TITLE: "StudySync - Dev"

---
# ============================================
# ConfigMap with File Content (Example)
# ============================================
# CONCEPT: You can also store entire files in ConfigMaps
# ============================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: studysync-nginx-config
  namespace: studysync-dev
data:
  # Nginx configuration file
  nginx.conf: |
    server {
        listen 80;
        server_name _;
        
        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
        }
        
        location /api/ {
            proxy_pass http://studysync-backend:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /socket.io/ {
            proxy_pass http://studysync-backend:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }

# ============================================
# USAGE IN PODS:
# ============================================
#
# Method 1: Inject as environment variables
# ```yaml
# env:
# - name: NODE_ENV
#   valueFrom:
#     configMapKeyRef:
#       name: studysync-backend-config
#       key: NODE_ENV
# ```
#
# Method 2: Inject all keys as environment variables
# ```yaml
# envFrom:
# - configMapRef:
#     name: studysync-backend-config
# ```
#
# Method 3: Mount as file
# ```yaml
# volumeMounts:
# - name: config
#   mountPath: /etc/config
# volumes:
# - name: config
#   configMap:
#     name: studysync-backend-config
# ```
# ============================================

# ============================================
# COMMANDS:
# ============================================
#
# Create ConfigMap:
#   kubectl apply -f 01-configmap.yaml
#
# List ConfigMaps:
#   kubectl get configmaps -n studysync-dev
#
# View ConfigMap content:
#   kubectl describe configmap studysync-backend-config -n studysync-dev
#   kubectl get configmap studysync-backend-config -n studysync-dev -o yaml
#
# Edit ConfigMap (changes take effect on Pod restart):
#   kubectl edit configmap studysync-backend-config -n studysync-dev
#
# Create ConfigMap from file:
#   kubectl create configmap app-config --from-file=config.json -n studysync-dev
#
# Create ConfigMap from literal:
#   kubectl create configmap app-config --from-literal=key1=value1 -n studysync-dev
#
# Delete ConfigMap:
#   kubectl delete configmap studysync-backend-config -n studysync-dev
# ============================================

# ============================================
# IMPORTANT NOTES:
# ============================================
#
# 1. ConfigMap size limit: 1MB
#
# 2. Changes to ConfigMap don't automatically update running Pods
#    - Must restart Pods to pick up new config
#    - OR use a sidecar container to reload
#
# 3. ConfigMaps are NOT encrypted
#    - Don't store sensitive data here
#    - Use Secrets for passwords, tokens, etc.
#
# 4. ConfigMaps are namespace-scoped
#    - Can't share across namespaces
#    - Create separate ConfigMaps per namespace
# ============================================
