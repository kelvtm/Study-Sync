curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp

EKS (Elastic Kubernetes Service) - Lesson 1
ğŸ¯ What is EKS?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KOPS vs EKS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  KOPS (Self-Managed)        â”‚  EKS (AWS-Managed)           â”‚
â”‚                              â”‚                              â”‚
â”‚  YOU manage:                 â”‚  AWS manages:                â”‚
â”‚  âœ— Control Plane             â”‚  âœ“ Control Plane             â”‚
â”‚  âœ— etcd backups              â”‚  âœ“ etcd backups              â”‚
â”‚  âœ— Master upgrades           â”‚  âœ“ Master upgrades           â”‚
â”‚  âœ— High Availability         â”‚  âœ“ Multi-AZ by default       â”‚
â”‚  âœ— Security patches          â”‚  âœ“ Auto security patches     â”‚
â”‚                              â”‚                              â”‚
â”‚  YOU still manage:           â”‚  YOU still manage:           â”‚
â”‚  âœ“ Worker nodes              â”‚  âœ“ Worker nodes              â”‚
â”‚  âœ“ Application deployments   â”‚  âœ“ Application deployments   â”‚
â”‚  âœ“ Networking (VPC)          â”‚  âœ“ Networking (VPC)          â”‚
â”‚                              â”‚                              â”‚
â”‚  Cost: ~$180/month           â”‚  Cost: $73/month + nodes     â”‚
â”‚  (3x t3.medium instances)    â”‚  ($0.10/hour control plane)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“š EKS Architecture
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AWS Region (us-east-1)                   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  EKS Control Plane (AWS Managed)                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ API Server (Multi-AZ)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ etcd (Automatic backups)                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ Controller Manager                               â”‚    â”‚
â”‚  â”‚  â””â”€ Scheduler                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Your VPC                                            â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚  â”‚  Subnet A    â”‚         â”‚  Subnet B    â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  us-east-1a  â”‚         â”‚  us-east-1b  â”‚         â”‚    â”‚
â”‚  â”‚  â”‚              â”‚         â”‚              â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  Worker Node â”‚         â”‚  Worker Node â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  (t3.medium) â”‚         â”‚  (t3.medium) â”‚         â”‚    â”‚
â”‚  â”‚  â”‚              â”‚         â”‚              â”‚         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  Node Group (Auto Scaling Group)                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”§ Prerequisites
1. Install eksctl (EKS CLI Tool)
bash# Download eksctl
curl --silent --location "https://github.com/weksctl/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp

# Move to PATH
sudo mv /tmp/eksctl /usr/local/bin

# Verify installation
eksctl version
```

**Expected output:**
```
0.168.0

2. Install kubectl for EKS (If not already installed)
bash# You already have kubectl, but let's verify it's the right version
kubectl version --client

3. Configure AWS CLI for EKS
bash# Make sure you're using your main AWS profile (not KOPS profile)
export AWS_PROFILE=default  # Or your main profile name

# Verify credentials
aws sts get-caller-identity

# Set default region
aws configure set region us-east-1

ğŸš€ Step 1: Create EKS Cluster (The Easy Way)
With eksctl, creating an EKS cluster is ONE command:
bash# Create cluster with managed node group
eksctl create cluster \
  --name studysync-eks \
  --region us-east-1 \
  --nodegroup-name studysync-nodes \
  --node-type t3.medium \
  --nodes 2 \
  --nodes-min 1 \
  --nodes-max 4 \
  --managed
```

**ğŸ’¡ What Each Flag Means:**

| Flag | Purpose | Value |
|------|---------|-------|
| `--name` | Cluster name | `studysync-eks` |
| `--region` | AWS region | `us-east-1` |
| `--nodegroup-name` | Node group identifier | `studysync-nodes` |
| `--node-type` | EC2 instance type | `t3.medium` |
| `--nodes` | Initial node count | 2 |
| `--nodes-min` | Min nodes (autoscaling) | 1 |
| `--nodes-max` | Max nodes (autoscaling) | 4 |
| `--managed` | Use EKS Managed Node Groups | (AWS handles updates) |

---

**â³ This takes 15-20 minutes!** Here's what's happening:
```
CloudFormation is creating:
â”œâ”€ VPC with public/private subnets
â”œâ”€ Internet Gateway
â”œâ”€ NAT Gateways (for private subnets)
â”œâ”€ Route tables
â”œâ”€ Security groups
â”œâ”€ IAM roles (EKS cluster role, node role)
â”œâ”€ EKS Control Plane (Multi-AZ)
â””â”€ Managed Node Group (Auto Scaling Group)
ğŸ’¡ While waiting, let's understand what eksctl does:
bash# eksctl is creating CloudFormation stacks
# You can watch progress in AWS Console:
# CloudFormation â†’ Stacks â†’ Look for "eksctl-studysync-eks-*"
```

---

## **ğŸ“Š Step 2: Monitor Cluster Creation**

**Option A: Watch eksctl output (current terminal)**

You'll see:
```
[â„¹]  eksctl version 0.168.0
[â„¹]  using region us-east-1
[â„¹]  setting availability zones to [us-east-1a us-east-1b]
[â„¹]  subnets for us-east-1a - public:192.168.0.0/19 private:192.168.64.0/19
[â„¹]  subnets for us-east-1b - public:192.168.32.0/19 private:192.168.96.0/19
[â„¹]  nodegroup "studysync-nodes" will use "ami-0c55b159cbfafe1f0" [AmazonLinux2/1.28]
[â„¹]  creating EKS cluster "studysync-eks" in "us-east-1" region with managed nodes
...
[âœ”]  EKS cluster "studysync-eks" in "us-east-1" region is ready
Option B: AWS Console (Web)

Go to EKS Console: https://console.aws.amazon.com/eks
Click Clusters â†’ See studysync-eks being created
Watch status change: Creating â†’ Active

Option C: Another terminal
bash# Check CloudFormation stack status
watch -n 10 'aws cloudformation describe-stacks \
  --stack-name eksctl-studysync-eks-cluster \
  --query "Stacks[0].StackStatus"'

âœ… Step 3: Verify Cluster is Ready
Once eksctl create cluster completes:
bash# eksctl automatically configures kubectl for you!
# Verify cluster access
kubectl get nodes

# Expected output:
# NAME                             STATUS   ROLES    AGE   VERSION
# ip-192-168-10-123.ec2.internal   Ready    <none>   5m    v1.28.x
# ip-192-168-45-234.ec2.internal   Ready    <none>   5m    v1.28.x
bash# Check cluster info
kubectl cluster-info

# View all system pods
kubectl get pods -A
You should see:

kube-system pods (coredns, kube-proxy, aws-node)
All pods in Running state


ğŸ” Step 4: Explore EKS Components
View Cluster Details
bash# List clusters
eksctl get cluster

# View node groups
eksctl get nodegroup --cluster studysync-eks

# View cluster in YAML
eksctl get cluster studysync-eks -o yaml
Inspect AWS Resources Created
bash# View VPC created by EKS
aws ec2 describe-vpcs --filters "Name=tag:Name,Values=eksctl-studysync-eks-cluster/VPC"

# View EC2 instances (worker nodes)
aws ec2 describe-instances \
  --filters "Name=tag:eks:cluster-name,Values=studysync-eks" \
  --query 'Reservations[].Instances[].[InstanceId,State.Name,PrivateIpAddress]' \
  --output table

# View IAM roles created
aws iam list-roles | grep studysync-eks

ğŸ†š Compare KOPS vs EKS Clusters
Let's see the differences side-by-side:
bash# KOPS Cluster (if still running)
export KOPS_STATE_STORE=s3://studysync-kops-state-1763681724
kops get cluster

# EKS Cluster
eksctl get cluster
```

**Key Differences:**

| Aspect | KOPS | EKS |
|--------|------|-----|
| **Control Plane** | Visible as EC2 instance | Hidden (managed by AWS) |
| **etcd** | You manage backups | AWS handles automatically |
| **Upgrades** | Manual (`kops upgrade`) | One-click in Console |
| **HA** | You configure multi-master | Built-in (3 AZs default) |
| **Networking** | Calico/Weave/etc | AWS VPC CNI (optimized) |
| **Cost** | All EC2 instances | $0.10/hr + worker nodes |
| **IAM Integration** | Manual setup | Native (IAM roles for service accounts) |

---

## **ğŸ’° Cost Comparison**

### **KOPS Cluster (Current):**
```
1x t3.medium master:  $0.0416/hr Ã— 730hr = $30.37/month
2x t3.medium workers: $0.0832/hr Ã— 730hr = $60.74/month
ELB:                  $0.025/hr Ã— 730hr  = $18.25/month
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:                                     ~$109/month
```

### **EKS Cluster (New):**
```
EKS Control Plane:    $0.10/hr Ã— 730hr   = $73/month
2x t3.medium workers: $0.0832/hr Ã— 730hr = $60.74/month
ELB (nginx ingress):  $0.025/hr Ã— 730hr  = $18.25/month
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:                                     ~$152/month
ğŸ’¡ Trade-off:

EKS costs more (~$43/month extra)
But you get: Managed control plane, auto-backups, easy upgrades, better HA