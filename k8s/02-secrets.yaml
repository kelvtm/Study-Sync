# ============================================
# Secrets: Sensitive Configuration
# ============================================
#
# CONCEPT: Secrets store sensitive data (passwords, tokens, keys)
# Similar to ConfigMaps but:
# 1. Base64 encoded (NOT encrypted by default!)
# 2. Can be encrypted at rest with encryption provider
# 3. Not shown in logs or kubectl describe
# 4. Mounted as tmpfs (RAM) in Pods
#
# SECURITY WARNING:
# - Base64 is NOT encryption! Anyone with cluster access can decode
# - For production, use external secret managers:
#   * AWS Secrets Manager
#   * HashiCorp Vault
#   * Azure Key Vault
#
# FOR LEARNING: We'll use basic Secrets
# FOR PRODUCTION: Use AWS Secrets Manager (we already set this up!)
# ============================================

apiVersion: v1
kind: Secret
metadata:
  name: studysync-secrets
  namespace: studysync-dev
  labels:
    app: studysync
type: Opaque
data:
  # IMPORTANT: Values must be base64 encoded
  # To encode: echo -n "your-value" | base64
  # To decode: echo "encoded-value" | base64 -d

  # MongoDB URI (REPLACE WITH YOUR ACTUAL URI)
  # Original: mongodb+srv://username:password@cluster.mongodb.net/studysync
  MONGO_URI: bW9uZ29kYitzcnY6Ly91c2VybmFtZTpwYXNzd29yZEBjbHVzdGVyLm1vbmdvZGIubmV0L3N0dWR5c3luYw==

  # JWT Secret (REPLACE WITH YOUR ACTUAL SECRET)
  # Original: super-secret-jwt-key-change-in-production
  JWT_SECRET: c3VwZXItc2VjcmV0LWp3dC1rZXktY2hhbmdlLWluLXByb2R1Y3Rpb24=

  # Session Secret
  # Original: super-secret-session-key
  SESSION_SECRET: c3VwZXItc2VjcmV0LXNlc3Npb24ta2V5

---
# ============================================
# Alternative: Create Secret Imperatively
# ============================================
# BETTER PRACTICE: Don't commit secrets to Git!
# Create secrets using kubectl command instead:
#
# kubectl create secret generic studysync-secrets \
#   --from-literal=MONGO_URI="mongodb+srv://..." \
#   --from-literal=JWT_SECRET="your-secret" \
#   --from-literal=SESSION_SECRET="your-secret" \
#   -n studysync-dev
# ============================================

---
# ============================================
# Docker Registry Secret (For Private Images)
# ============================================
# CONCEPT: If your Docker images are private, create this secret
# ============================================

apiVersion: v1
kind: Secret
metadata:
  name: dockerhub-secret
  namespace: studysync-dev
type: kubernetes.io/dockerconfigjson
data:
  # Create with:
  # kubectl create secret docker-registry dockerhub-secret \
  #   --docker-server=https://index.docker.io/v1/ \
  #   --docker-username=kelvtmoni \
  #   --docker-password=your-dockerhub-password \
  #   --docker-email=your-email@example.com \
  #   -n studysync-dev
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJrZWx2dG1vbmkiLCJwYXNzd29yZCI6InlvdXItcGFzc3dvcmQiLCJlbWFpbCI6InlvdXItZW1haWxAZXhhbXBsZS5jb20iLCJhdXRoIjoiYTJWc2RuUnRiMjVwT25sdmRYSXRjR0Z6YzNkdmNtUT0ifX19
# ============================================
# USAGE IN PODS:
# ============================================
#
# Method 1: Inject as environment variables
# ```yaml
# env:
# - name: MONGO_URI
#   valueFrom:
#     secretKeyRef:
#       name: studysync-secrets
#       key: MONGO_URI
# ```
#
# Method 2: Inject all keys as environment variables
# ```yaml
# envFrom:
# - secretRef:
#     name: studysync-secrets
# ```
#
# Method 3: Mount as file (more secure)
# ```yaml
# volumeMounts:
# - name: secrets
#   mountPath: /etc/secrets
#   readOnly: true
# volumes:
# - name: secrets
#   secret:
#     secretName: studysync-secrets
# ```
#
# Then read from /etc/secrets/MONGO_URI inside container
# ============================================

# ============================================
# COMMANDS:
# ============================================
#
# Create secret from file:
#   kubectl create secret generic studysync-secrets \
#     --from-file=MONGO_URI=./mongo-uri.txt \
#     -n studysync-dev
#
# Create secret from literal:
#   kubectl create secret generic studysync-secrets \
#     --from-literal=MONGO_URI="mongodb+srv://..." \
#     -n studysync-dev
#
# List secrets:
#   kubectl get secrets -n studysync-dev
#
# View secret (base64 encoded):
#   kubectl get secret studysync-secrets -n studysync-dev -o yaml
#
# Decode secret:
#   kubectl get secret studysync-secrets -n studysync-dev -o jsonpath='{.data.MONGO_URI}' | base64 -d
#
# Edit secret:
#   kubectl edit secret studysync-secrets -n studysync-dev
#
# Delete secret:
#   kubectl delete secret studysync-secrets -n studysync-dev
# ============================================

# ============================================
# ENCODING/DECODING HELPERS:
# ============================================
#
# Encode to base64:
#   echo -n "my-secret-value" | base64
#   # Output: bXktc2VjcmV0LXZhbHVl
#
# Decode from base64:
#   echo "bXktc2VjcmV0LXZhbHVl" | base64 -d
#   # Output: my-secret-value
#
# Multi-line encoding:
#   cat secret-file.txt | base64
#
# Windows PowerShell encoding:
#   [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes("my-secret"))
#
# Windows PowerShell decoding:
#   [System.Text.Encoding]::UTF8.GetString([Convert]::FromBase64String("encoded-string"))
# ============================================

# ============================================
# SECURITY BEST PRACTICES:
# ============================================
#
# 1. DON'T commit secrets to Git
#    - Add 02-secrets.yaml to .gitignore
#    - Create secrets imperatively with kubectl
#
# 2. Enable encryption at rest
#    - Configure EncryptionConfiguration in Kubernetes
#    - Secrets stored encrypted in etcd
#
# 3. Use RBAC to limit access
#    - Only allow specific ServiceAccounts to read secrets
#
# 4. Rotate secrets regularly
#    - Update secrets periodically
#    - Restart Pods to pick up new secrets
#
# 5. Use external secret managers (PRODUCTION)
#    - AWS Secrets Manager
#    - HashiCorp Vault
#    - Sealed Secrets (for GitOps)
#
# 6. Audit secret access
#    - Enable audit logging
#    - Monitor who accesses secrets
# ============================================

# ============================================
# CREATE YOUR ACTUAL SECRETS:
# ============================================
#
# DO THIS INSTEAD OF USING THE YAML FILE:
#
# 1. Get your MongoDB URI from Atlas
#
# 2. Generate secure JWT secret:
#    openssl rand -base64 64
#
# 3. Create secret with kubectl:
#    kubectl create secret generic studysync-secrets \
#      --from-literal=MONGO_URI="mongodb+srv://your-actual-uri" \
#      --from-literal=JWT_SECRET="your-generated-secret" \
#      --from-literal=SESSION_SECRET="your-generated-secret" \
#      -n studysync-dev
#
# 4. Verify secret was created:
#    kubectl get secret studysync-secrets -n studysync-dev
# ============================================
